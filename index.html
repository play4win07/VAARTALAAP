<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced 2 Person Video Call App</title>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <style>
    body {
      font-family: system-ui, Arial, sans-serif;
      background: linear-gradient(135deg, #020617, #0f172a);
      color: white;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      width: 100%;
      padding: 12px;
      text-align: center;
      background: #020617;
      font-weight: bold;
    }
    .container {
      width: 100%;
      max-width: 420px;
      padding: 12px;
    }
    .code-box {
      background: #1e293b;
      padding: 10px;
      border-radius: 10px;
      text-align: center;
    }
    input, button, select {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
    }
    button {
      background: #22c55e;
      font-weight: bold;
      cursor: pointer;
    }
    button.secondary {
      background: #334155;
    }
    #videos {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
    video {
      width: 100%;
      max-width: 200px;
      aspect-ratio: 4 / 3;
      background: black;
      border-radius: 12px;
    }
    .controls {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    .controls button {
      flex: 1;
    }
    .filters {
      margin-top: 10px;
      background: #020617;
      padding: 10px;
      border-radius: 10px;
    }
    .status {
      font-size: 13px;
      margin-top: 6px;
      color: #93c5fd;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>ðŸ“± Advanced Video Call Web App</header>

  <div class="container">
    <div class="code-box">
      <div>Your Code</div>
      <strong id="myCode">Loadingâ€¦</strong>
    </div>

    <input id="joinCode" placeholder="Enter or auto-filled code" />
    <button id="joinBtn" disabled>Join Call</button>

    <div class="status" id="status">Initializingâ€¦</div>

    <div id="videos">
      <video id="myVideo" autoplay muted playsinline></video>
      <video id="remoteVideo" autoplay playsinline></video>
    </div>

    <div class="controls">
      <button id="muteBtn" class="secondary">ðŸ”‡ Mute</button>
      <button id="camBtn" class="secondary">ðŸ“· Off</button>
    </div>

    <div class="filters">
      <div><b>ðŸŽ¨ Video Filters</b></div>
      <select id="videoFilter">
        <option value="none">Normal</option>
        <option value="brightness(1.2) contrast(1.2)">HD Enhance</option>
        <option value="brightness(1.3) saturate(1.3)">Glow / Fair</option>
        <option value="contrast(1.4)">Sharp 4K Look</option>
      </select>

      <div style="margin-top:8px"><b>ðŸŽ¤ Audio</b></div>
      <select id="audioFilter">
        <option value="normal">Normal Voice</option>
        <option value="female">Female (Pitch Up)</option>
        <option value="noise">Noise Reduction</option>
      </select>
    </div>
  </div>

  <script>
    const myVideo = document.getElementById('myVideo');
    const remoteVideo = document.getElementById('remoteVideo');
    const joinBtn = document.getElementById('joinBtn');
    const statusEl = document.getElementById('status');

    let myStream;
    let audioTrack;
    let videoTrack;
    let isMuted = false;
    let camOff = false;

    const peer = new Peer();

    // Auto-fill join code from URL (?code=xxxx)
    const params = new URLSearchParams(window.location.search);
    if (params.get('code')) {
      document.getElementById('joinCode').value = params.get('code');
    }

    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
      .then(stream => {
        myStream = stream;
        myVideo.srcObject = stream;
        audioTrack = stream.getAudioTracks()[0];
        videoTrack = stream.getVideoTracks()[0];
        joinBtn.disabled = false;
        statusEl.innerText = 'Ready';
      })
      .catch(() => statusEl.innerText = 'Camera/Mic permission denied');

    peer.on('open', id => {
      document.getElementById('myCode').innerText = id;
      const shareLink = window.location.origin + window.location.pathname + '?code=' + id;
      statusEl.innerText = 'Share link: ' + shareLink;
    });

    peer.on('call', call => {
      call.answer(myStream);
      call.on('stream', s => remoteVideo.srcObject = s);
    });

    joinBtn.onclick = () => {
      const code = document.getElementById('joinCode').value.trim();
      if (!code) return alert('Enter code');
      const call = peer.call(code, myStream);
      if (!call) return;
      call.on('stream', s => remoteVideo.srcObject = s);
    };

    // Mute
    document.getElementById('muteBtn').onclick = () => {
      isMuted = !isMuted;
      audioTrack.enabled = !isMuted;
      event.target.innerText = isMuted ? 'ðŸ”Š Unmute' : 'ðŸ”‡ Mute';
    };

    // Camera
    document.getElementById('camBtn').onclick = () => {
      camOff = !camOff;
      videoTrack.enabled = !camOff;
      event.target.innerText = camOff ? 'ðŸ“· On' : 'ðŸ“· Off';
    };

    // Video filters (CSS based)
    document.getElementById('videoFilter').onchange = e => {
      myVideo.style.filter = e.target.value === 'none' ? 'none' : e.target.value;
    };

    // Audio filters (basic Web Audio)
    const audioCtx = new AudioContext();
    const source = audioCtx.createMediaStreamSource(myStream || new MediaStream());
    const gain = audioCtx.createGain();

    document.getElementById('audioFilter').onchange = e => {
      if (!audioTrack) return;
      if (e.target.value === 'female') {
        gain.gain.value = 1.4; // pitch illusion (basic)
      } else {
        gain.gain.value = 1.0;
      }
    };
  </script>
</body>
</html>
